# Отчет о тестировании SuperScooters

## Статус
✅ Все тесты пройдены успешно

## Структура тестов

### 1. Unit-тесты (`tests/unit/`)

**test_pricing_utils.py** — тесты утилит ценообразования
- Генерация и валидация pricing-токенов
- Хеширование офферов (детерминированность, защита от подделки)
- Декодирование токенов и проверка срока действия
- Защита от несоответствия версий тарифов и алгоритмов

**Покрытие:** 20 тестов

---

### 2. Тесты офферов (`tests/offers/`)

#### test_create_offer.py
- Создание оффера с возвратом pricing-токена
- Блокировка создания оффера для пользователей с текущим долгом
- Увеличенный депозит для пользователей с большим общим долгом

#### test_offer_pricing.py
- Влияние surge-pricing на цену за минуту
- Расчет депозита для пользователей с высоким долгом (1.25x)
- Стандартный депозит для обычных пользователей
- Включение zone_id в оффер
- Уникальность ID офферов и токенов

#### test_offer_scenarios.py
- Офферы для самокатов в разных зонах
- Множественные офферы для одного пользователя
- Консистентность ценообразования
- Корректная структура ответа (все обязательные поля)
- Позитивные значения всех цен

#### test_offer_validation.py
- Валидация обязательных полей (user_id, scooter_id)
- Обработка некорректного JSON
- Проверка блокировки пользователей с активным долгом

**Покрытие:** 18 тестов

---

### 3. Тесты заказов (`tests/orders/`)

#### test_order_flow.py
- Получение данных заказа до и после завершения
- Последовательное выполнение нескольких заказов одним пользователем
- Сохранение user_id и scooter_id из оффера
- Уникальность ID заказов
- Зависимость стоимости от продолжительности поездки

#### test_order_lifecycle.py
- Полный жизненный цикл заказа (создание → выполнение → завершение)
- Состояние заказа во время поездки
- Идемпотентность получения данных заказа
- Сохранение данных из оффера
- Корректный формат временных меток
- Независимость множественных заказов

#### test_order_edge_cases.py
- Обработка попыток повторного старта с одним оффером
- Состояние заказа во время и после поездки
- Консистентность данных при многократном получении

#### test_order_pricing.py
- Бесплатные поездки короче 5 секунд
- Корректный расчет стоимости на основе длительности
- Сохранение ценообразования из оффера
- Начальная стоимость = 0
- finish_time > start_time

#### test_order_validation.py
- Валидация pricing-токена (отклонение невалидных токенов)
- Проверка обязательных полей (offer, pricing_token)
- Наличие всех обязательных полей в ответе

**Покрытие:** 27 тестов

---

### 4. Интеграционные тесты (`tests/integration/`)

#### test_full_scenarios.py
- Полный сценарий аренды: оффер → заказ → завершение → проверка
- Параллельные аренды разными пользователями
- Последовательная аренда одного самоката разными пользователями
- Увеличенный депозит для пользователей с высоким долгом
- Бесплатные короткие поездки (< 5 сек)
- Множественное получение данных заказа

**Покрытие:** 9 тестов

---

## Итоги

**Всего тестов:** 74  
**Успешно пройдено:** 74 (100%)  
**Типы тестов:**
- Unit-тесты: 20
- Интеграционные тесты: 54

### Проверенная функциональность:
✅ Создание и валидация офферов  
✅ Ценообразование (базовое, surge, депозиты)  
✅ Жизненный цикл заказов  
✅ Работа с долгами пользователей  
✅ Защита от подделки pricing-токенов  
✅ Валидация входных данных  
✅ Граничные случаи (короткие поездки, параллельные заказы)  
✅ Полные пользовательские сценарии

